function coefs = bicubic_polynomial(h, k, p, px, py, pxy)

if ~isscalar(h) | ~isscalar(k)
    error('Surface grid width and height must both be scalars.');
end

if ~(all(size(p) == size(px)) ...
     & all(size(p) == size(py)) ...
     & all(size(p) == size(pxy)))
    error(['Input function and  derivative matrices must have identical ' ...
           'dimensions.']);
end

% For alpha = [a00 a10 a20 a30 a01 a11 a21 a31 a02 a12 a22 a32 a03 a13 a23 a33]
% and x = [f(0,0) f(h,0) f(0,k) f(h,k) fx(0,0) fx(h,0) fx(0,k) fx(h,k)
%            fy(0,0) fy(h,0) fy(0,k) fy(h,k) fxy(0,0) fxy(h,0) fxy(0,k) fxy(h,k)]
% we have A*alpha = x, so we can solve for alpha = (A^-1)*x
A = [1 0 0   0     0 0   0     0       0   0     0       0         0     0       0       0;           ...
     1 h h^2 h^3   0 0   0     0       0   0     0       0         0     0       0       0;           ...
     1 0 0   0     k 0   0     0       k^2 0     0       0         k^3   0       0       0;           ...
     1 h h^2 h^3   k h*k h^2*k h^3*k   k^2 h*k^2 h^2*k^2 h^3*k^2   k^3   h*k^3   h^2*k^3 h^3*k^3;     ...
     0 1 0   0     0 0   0     0       0   0     0       0         0     0       0       0;           ...
     0 1 2*h 3*h^2 0 0   0     0       0   0     0       0         0     0       0       0;           ...
     0 1 0   0     0 k   0     0       0   k^2   0       0         0     k^3     0       0;           ...
     0 1 2*h 3*h^2 0 k   2*h*k 3*h^2*k 0   k^2   2*h*k^2 3*h^2*k^2 0     k^3     2*h*k^3 3*h^2*k^3;   ...
     0 0 0   0     1 0   0     0       0   0     0       0         0     0       0       0;           ...
     0 0 0   0     1 h   h^2   h^3     0   0     0       0         0     0       0       0;           ...
     0 0 0   0     1 0   0     0       2*k 0     0       0         3*k^2 0       0       0;           ...
     0 0 0   0     1 h   h^2   h^3     2*k 2*h*k 2*h^2*k 2*h^3*k   3*k^2 3*h*k^2 3*h^2*k^2 3*h^3*k^3; ...
     0 0 0   0     0 1   0     0       0   0     0       0         0     0       0       0;           ...
     0 0 0   0     0 1   2*h   3*h^2   0   0     0       0         0     0       0       0;           ...
     0 0 0   0     0 1   0     0       0   2*k   0       0         0     3*k^2   0       0;           ...
     0 0 0   0     0 1   2*h   3*h^2   0   2*k   4*h*k   6*h^2*k   0     3*k^2   6*h*k^2 9*h^2*k^2];
